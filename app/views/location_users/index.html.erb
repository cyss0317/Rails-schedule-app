<!-- app/views/location_users/index.html.erb -->
<div class="mx-auto max-w-3xl p-3 sm:p-4">
  <div class="flex items-center justify-between mb-3 sm:mb-4">
    <h1 class="text-xl sm:text-2xl font-semibold text-gray-900">Location Users</h1>
    <%= render partial: "shared/icons/hamburger", locals: { current: "month" } %>
  </div>

  <div class="divide-y rounded-xl border border-gray-200 bg-white shadow-sm">
    <% @location_users.each do |lu| %>
      <%= turbo_frame_tag dom_id(lu) do %>
        <!-- Stack on mobile, row on larger screens -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 p-3 sm:p-4">
          <!-- Name / email -->
          <div class="min-w-0">
            <p class="font-medium text-gray-900 m-0 text-base sm:text-lg truncate">
              <%= lu.user.first_name %> <%= lu.user.last_name %>
              <span class="text-gray-600">( <%= lu.user.email %> )</span>
            </p>
          </div>

          <!-- Right cluster: Role + Toggle -->
          <div
            class="flex items-center gap-2 sm:gap-3 sm:ml-auto"
            data-controller="active-toggle"
            data-active-toggle-url-value="<%= toggle_active_location_user_path(lu) %>"
          >
            <!-- Role label (compact on phones) -->
            <div class="text-gray-700">
              <span class="hidden sm:inline">Role:</span>
              <span class="font-medium <%= lu.admin? ? 'text-indigo-600' : 'text-gray-800' %>">
                <%= lu.role.camelize %>
              </span>
            </div>
            <span class="sr-only">Toggle active</span>

            <!-- Switch: bigger on phones; shows "Active" only when true -->
            <label class="relative inline-flex items-center cursor-pointer select-none
                           h-9 w-28 sm:h-8 sm:w-28">
              <!-- Checkbox -->
              <input
                type="checkbox"
                class="peer sr-only"
                data-action="change->active-toggle#toggle"
                data-active-toggle-target="checkbox"
                role="switch"
                aria-label="Set user active status"
                aria-checked="<%= lu.active? %>"
                <%= 'checked' if lu.active? %>
              >

              <!-- Track -->
              <span class="absolute inset-0 rounded-full transition-colors
                           bg-gray-300 peer-checked:bg-green-600
                           ring-1 ring-inset ring-gray-300 peer-checked:ring-green-600"></span>

              <!-- In-track label; smaller on phones -->
              <span
                data-active-toggle-target="label"
                class="absolute inset-0 grid place-items-center font-semibold transition-colors
                       text-[11px] sm:text-sm
                       <%= lu.active? ? 'text-white' : 'text-transparent' %>">
                <%= lu.active? ? 'Active' : '' %>
              </span>

              <!-- Knob: bigger/tappable on phones; travel matches width -->
              <span class="relative rounded-full bg-white shadow transition-transform
                           h-7 w-7 sm:h-6 sm:w-6
                           translate-x-1
                           peer-checked:translate-x-[4.25rem] sm:peer-checked:translate-x-20"></span>

              <!-- Optional loading overlay (hook it up in Stimulus if you want) -->
              <span data-active-toggle-target="spinner"
                    class="pointer-events-none hidden absolute inset-0 grid place-items-center">
                <svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"/>
                  <path d="M22 12a10 10 0 0 1-10 10" stroke="currentColor" stroke-width="4" class="opacity-75"/>
                </svg>
              </span>
            </label>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
